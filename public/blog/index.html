
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Tools, Rants and Day-to-day Shenanigans  | Motivated Automator</title>

<meta name="author" content="Liam Bennett"> 

<meta name="description" content="Ok, so you’ve seen the date of this post. I’m not exactly as regular with these posts as I would like but it seems that I do in fact still have &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Motivated Automator" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css" media="screen" />
<script type="text/javascript" src="/fancybox/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Motivated Automator</a></h1>
<h4>Tools, Rants and Day-to-day Shenanigans</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:yoursite.com">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/03/23/quick-update/">
		
			[Quick Update] - 23-Mar-2015</a>
	</h2>
	<div class="entry-content">
		<p>Ok, so you’ve seen the date of this post. I’m not exactly as regular with these posts as I would like but it seems that I do in fact still have things to write about.</p>

<h4> Foreman</h4>

<p>One of the big things that I have been working on recently has been in puppetizing the foreman infrastructure used at OpenTable. Thankfully this is quite a mature community and there has already been a lot of work done however one limitation that I found was that I wanted to actually use puppet to configure foreman after I had installed it.</p>

<p>For anyone that has actually spent some time with foreman you will know that entity model is a little complex and it can take a long time to configure with settings specific to your organization. Having a somewhat ageing foreman installation meant that we were suffering from the problems of any aging, snow-flaked system, namely it was flakey and no one wanted to make changes to it. This is when I decided that this was a good opportunity to extend the already existing puppet module to support this entity model with custom types/providers.</p>

<p>This was my first foray into writing types and providers so it took a little longer than might be expected and took several iterations to get the code working and more importantly, performant. Writing types and providers is still one of those areas that I don’t think is a well documented process and is not for the unexperienced. For the majority of my time I had <a href="">this</a> wonder blog open, in addition to <a href="">the book</a> and the <a href="">puppet documentation</a> on the subject. Only with the arsenal of resources available was I able to tackle the challenge. Thankfully a couple of weeks of hacking later and I managed to have types for all the major foreman components: operatingsystems, configuration templates, provisioning profiles etc.</p>

<p>Take a look at my work and see what you think &hellip;</p>

<h4>puppet-community</h4>

<p>Puppet community is a github organization that has been developing for some time now. The idea behind the project/community is provide a shared space for puppet modules to live and be developed. It’s key benefits are really just starting to develop but are quite useful &ndash; shared build scripts, shared testing infrastructure and shared development and PR management. The hope is that with the experience that is found in the community the quality of the modules in the community as a whole will increase.</p>

<p>Being a separate non-corporate, non-individual entity means that when a primary author moves organizations and/or does not have the time to work on a module any more they have people who will continue to support it. This is huge, as anyone who has any more than about 5 modules on the forge will tell you &ndash; managing PRs and releasing updates can become a big job pretty fast. I know there are 8 modules authored by me personally and over 10 authored by myself and my OpenTable colleagues &ndash; this was becoming a full time job.</p>

<p>As you might be able to assume by this point, I am a huge fan of the project and I have been moving both my own personal modules as well as a number of OpenTable modules into the community. I won’t discuss this aspect any further, because there will be a much larger post of the subject &ndash; but be assured, it’s very exciting and a good move for all the users of all the modules I have written.</p>

<h4>puppet notes</h4>

<p>Finally anther small thing I have been working on is externalizing the notes I have been keeping about puppet over the last couple of years.  These notes over everything from weird edge-cases you might run into, certain style guides and by far the largest part of the notes is on different code patterns I have been and my comments on them. As you might expect there is lots of content in there on several different approaches to the same problem &ndash; I have been doing my best to document these, including when I think they can be used and trying to pick a favourite.  I’d love for you to take a look and let me know your thoughts.</p>

<p>* * *</p>

<p>Hopefully by now you are not too bored and have found some interesting things. In which case you should absolutely reach out to be at <a href="https://twitter.com/liamjbennett">@liamjbennett</a> and let me know your thoughts.</p>

<p>Until next time …..</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-03-23T08:50:00+00:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2015</time></div>
	<div class="tags">

</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/03/12/quick-update/">
		
			[Quick Update] - 12-Mar-2015</a>
	</h2>
	<div class="entry-content">
		<p>It has recently been commented by a few individuals that I am a poor communicator of some of the interesting things that I am usually hacking on. I guess they are right and I thought that rather than wait and do a big-bang style blog post of the usual multi-thousand word variety that I would start trying to write these little posts in about 30 minutes and see how that works out. By the time your reading this I will have likely already written several and managed to build up a least a little motivation in writing again.</p>

<p>* * *</p>

<p>With all that in mind, what have I actually been working on recently?</p>

<h4>The slow road towards linux on the desktop</h4>

<p>Like almost all of my peers, it seems that for a number of years now I have been spending 40+ hours a week curled up with my macbook only to be dissatisfied with the operating system that it comes with. I have already seen a number people start to make the transition to Linux or BSD on the desktop and I think that 2015 might be the year for me (if you’re reading this after 2015 &ndash; don’t laugh too hard because I really meant it). With that target in mind I have been spending some time reducing my tooling to only those things that are cross-platform, preferring the command-line and making a note of all those things that I might have to keep OS X around for. So far in the past few months I have changed my password manager (1password to lastpass) my editor (atom to tmux+vim) and made a good list of things I like on OS X (RoyalTSX and VMware fusion) none of which seems to be blocking my transition. I am sure that this little project might turn into one of those big-bang blogs &ndash; but don’t hold your breath ;)</p>

<h4>A few more updates with testing puppet on windows</h4>

<p>So I wrote (this) post a while back and I have continue to work on the project and getting the changes that need to made into the master branch of beaker for everyone to use easily. This is almost done now so over the next few weeks you should be able to really start testing those modules &ndash; with our packer images of course.</p>

<h4>Updates to those packer images</h4>

<p>From the download numbers it seems like a number of your like using those windows images that I created so I am very happy about that. If you go and take another look at the page on atlas you should see that there a number of new versions there now that you might want to play with. We unfortunately had to temporally close-source the packer templates behind those images while we dealt with an issue with the bitvise installation, although expect this to be open again very soon. In addition to that I am very excited with the things going on over at the packer-community project. It seems like the plugins are now there so that we will eventually be able to remove the bitvise dependency completely, which is exciting.</p>

<p>* * *</p>

<p>Ok, so that’s enough for this first 30-minute update, but don’t worry I have plenty more updates to come in the following days so stay tuned for that.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-03-12T08:50:00+00:00" pubdate data-updated="true">Mar 12<span>th</span>, 2015</time></div>
	<div class="tags">

</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/10/06/puppetconf-2014-part-3/">
		
			Puppetconf 2014 - Part 3</a>
	</h2>
	<div class="entry-content">
		<p>The third instalment of my review of the 2014 Puppet conference:</p>

<p><a href="http://tech.opentable.co.uk/blog/2014/10/06/puppetconf-2014-part-3/">http://tech.opentable.co.uk/blog/2014/10/06/puppetconf-2014-part-3/</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-10-06T12:06:00+01:00" pubdate data-updated="true">Oct 6<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/conferences/'>conferences</a>, <a class='category' href='/blog/categories/puppet/'>puppet</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/10/06/puppetconf-2014-part-2/">
		
			Puppetconf 2014 - Part 2</a>
	</h2>
	<div class="entry-content">
		<p>The second instalment of my review of the 2014 Puppet conference:</p>

<p><a href="http://tech.opentable.co.uk/blog/2014/10/06/puppetconf-2014-part-2/">http://tech.opentable.co.uk/blog/2014/10/06/puppetconf-2014-part-2/</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-10-06T12:06:00+01:00" pubdate data-updated="true">Oct 6<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/conferences/'>conferences</a>, <a class='category' href='/blog/categories/puppet/'>puppet</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/10/06/puppetconf-2014-part-1/">
		
			Puppetconf 2014 - Part 1</a>
	</h2>
	<div class="entry-content">
		<p>The first installation of my review of the 2014 Puppet conference.</p>

<p>This series of posts will cover the talks, workshops and the contributors summit.</p>

<p><a href="http://tech.opentable.co.uk/blog/2014/10/06/puppetconf-2014-part-1/">http://tech.opentable.co.uk/blog/2014/10/06/puppetconf-2014-part-1/</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-10-06T12:06:00+01:00" pubdate data-updated="true">Oct 6<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/conferences/'>conferences</a>, <a class='category' href='/blog/categories/puppet/'>puppet</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/09/01/testing-puppet-with-beaker-pt-dot-3-testing-roles/">
		
			Testing Puppet With Beaker Pt 3 - Testing Roles and Profiles</a>
	</h2>
	<div class="entry-content">
		<p>The third installation in this series cover the usecase of testing roles and profiles.</p>

<p><a href="http://tech.opentable.co.uk/blog/2014/09/01/testing-puppet-with-beaker-pt-dot-3-testing-roles/">http://tech.opentable.co.uk/blog/2014/09/01/testing-puppet-with-beaker-pt-dot-3-testing-roles/</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-09-01T12:06:00+01:00" pubdate data-updated="true">Sep 1<span>st</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/beaker/'>beaker</a>, <a class='category' href='/blog/categories/configuration-management/'>configuration-management</a>, <a class='category' href='/blog/categories/puppet/'>puppet</a>, <a class='category' href='/blog/categories/testing/'>testing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/09/01/testing-puppet-with-beaker-pt-dot-2-the-windows-story/">
		
			Testing Puppet With Beaker Pt 2 - the Windows Story</a>
	</h2>
	<div class="entry-content">
		<p>The second instalment in the series on the Beaker testing tool.</p>

<p>This post covers the work that was done to enhance the tool for testing windows systems.</p>

<p><a href="http://tech.opentable.co.uk/blog/2014/09/01/testing-puppet-with-beaker-pt-dot-2-the-windows-story/">http://tech.opentable.co.uk/blog/2014/09/01/testing-puppet-with-beaker-pt-dot-2-the-windows-story/</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-09-01T12:06:00+01:00" pubdate data-updated="true">Sep 1<span>st</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/beaker/'>beaker</a>, <a class='category' href='/blog/categories/configuration-management/'>configuration-management</a>, <a class='category' href='/blog/categories/puppet/'>puppet</a>, <a class='category' href='/blog/categories/testing/'>testing</a>, <a class='category' href='/blog/categories/windows/'>windows</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/04/04/testing-puppet-with-beaker/">
		
			Testing Puppet With Beaker</a>
	</h2>
	<div class="entry-content">
		<p>The first instalment of a series of posts covering the Puppet testing tool Beaker (<a href="https://github.com/puppetlabs/beaker">https://github.com/puppetlabs/beaker</a>)</p>

<p>This first post is an initial introduction.</p>

<p><a href="http://tech.opentable.co.uk/blog/2014/04/04/testing-puppet-with-beaker/">http://tech.opentable.co.uk/blog/2014/04/04/testing-puppet-with-beaker/</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-04-04T12:06:00+01:00" pubdate data-updated="true">Apr 4<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/beaker/'>beaker</a>, <a class='category' href='/blog/categories/configuration-management/'>configuration-management</a>, <a class='category' href='/blog/categories/puppet/'>puppet</a>, <a class='category' href='/blog/categories/testing/'>testing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/12/11/profiles-roles-stacks-and-clouds/">
		
			Profiles, Roles, Stacks and Clouds</a>
	</h2>
	<div class="entry-content">
		<p>One of the more recent patterns in structuring out puppet manifests is: roles and profiles <a href="#968504594f013f0067f2c0f7ec5c5fb8">[1]</a> <a href="#9031aeaf735f6dffb9872a8328853a5f">[2]</a>. The summary is this: profiles are a collection of classes/modules and roles are a collection of profiles. Having started to re-factor our own infratructure with this pattern recently there was one question that cam immediately to mind .. what&rsquo;s next?</p>

<p>Roles and profiles is all about abstraction. With roles all I have to care about is what &ldquo;type&rdquo; of node I am building:</p>

<pre><code>class role::www inherits role {
  include profile::tomcat
}
</code></pre>

<p>But what is the next abstraction? How far can we abstract?</p>

<h3>Stack</h3>

<p>Can we group together those nodes and roles? What I would like to see is the &ldquo;stack&rdquo; ..</p>

<pre><code>define stack::webstack(
  $node_webserver,
  $node_appserver,
  $node_dbserver
) {
     node $node_webserver {
       include role::webserver
     }

     node $node_appserver {
       include role::appserver
     }

     node $node_dbserver {
       include role::dbserver
     }
 }
</code></pre>

<p>This does use the node declarations rather than the ENC but it can allow us to scale out small indeependant infrastucture quickly.</p>

<h3>Cloud</h3>

<p>Puppet also is now moving beyound the server to network swtiches and embedded hardware. Can we also extend out thinking beyond the 3-tier web stack? Can we use puppet to manage independent regions or independent clouds? I would like to see something like the following &hellip;</p>

<pre><code>define cloud::region(
  $stack
  $network
) {
  include $stack

  network_route { $network:
    ensure    =&gt; 'present',
    gateway   =&gt; '10.0.2.2',
    interface =&gt; 'eth0',
    netmask   =&gt; '255.255.255.0',
    network   =&gt; '172.17.67.0'
  }
}
</code></pre>

<p>Do I have any code to show? Not yet. What I have is lots and lots of questions ..</p>

<br/><br/>


<p>If you want to discuss this more then reach out to me on twitter <a href="https://twitter.com/liamjbennett">@liamjbennett</a></p>

<h3>References</h3>

<ul style="list-style-type: none; padding:0; margin:0;">
  <li>
    <a name="968504594f013f0067f2c0f7ec5c5fb8">[1] http://www.craigdunn.org/2012/05/239/ </a>
  </li>
  <li>
    <a name="9031aeaf735f6dffb9872a8328853a5f">[2] http://www.slideshare.net/PuppetLabs/roles-talk </a>
  </li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-12-11T12:06:00+00:00" pubdate data-updated="true">Dec 11<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/configuration-management/'>configuration-management</a>, <a class='category' href='/blog/categories/puppet/'>puppet</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/12/11/puppet-on-windows-part-2/">
		
			Puppet on Windows - Part 2</a>
	</h2>
	<div class="entry-content">
		<p>In <a href="/blog/2013/10/06/puppet-on-windows-part-1">part 1</a> of this series of posts I discussed some of the challenges when writing modules for puppet on windows: documentation, packging, ISOs and reboots. In part 2 I will discuss how I learnt about this, about the modules that I have written, the learning outcomes and about contributing to the forge.</p>

<p>There are many ways that you can contribute and extend puppet: classes, defintions, facts, types and providers. Of the modules that I have written I wanted to specifically look at the following:</p>

<ul>
<li><a href="http://forge.puppetlabs.com/liamjbennett/win_facts">win_facts</a></li>
<li><a href="http://forge.puppetlabs.com/liamjbennett/dotnet">dotnet</a></li>
<li><a href="http://forge.puppetlabs.com/liamjbennett/msoffice">msoffice</a></li>
<li><a href="http://forge.puppetlabs.com/liamjbennett/windows_firewall">windows_firewall</a></li>
</ul>


<h3>Writing facter facts (win_facts)</h3>

<p>Writing facter facts is actually a good place to start with puppet. What is puppet not telling you about the system? Puppetlabs have actually provided a very useful tool that tells you lots of great information about the system but in some areas, either in general (platform-speific) cases or in your specific edge cases it might not give you that information you were hoping for.</p>

<p>When I started working with Windows the only facts that classied specifically for windows were:</p>

<pre><code>:kernel =&gt; windows
:operatingsystem =&gt; windows
</code></pre>

<p>While this is useful if your mananging windows machines in an existing linux environment and want to seperately classify them, if you&rsquo;ve got multiple versions of windows then your going to need a little bit more. This is why I started to write win_facts which provided the following additional facts:</p>

<pre><code>:operatingsystemversion  =&gt; "Windows Server 2008 R2"
:windows_productkey      =&gt; "XXX-XXX-XXX-XXX-XXX"
:windows_sid                  =&gt; "S-1-S"
:windows_systemtype      =&gt; "x64"
</code></pre>

<p>These facts use two techniques that I want to draw attention to: The <strong>registry read</strong> and the <strong>command wrapping</strong>:</p>

<pre><code>...
require 'win32/registry'

 Win32::Registry::HKEY_LOCAL_MACHINE.open('Software\Microsoft\Windows NT\CurrentVersion') do |reg|
    reg.each do |name,type,data|
      if name.eql?("ProductName")
        operatingsystemversion = data
      end
    end
 end
 ...
</code></pre>

<p>(see: <a href="https://raw.github.com/liamjbennett/puppet-win_facts/master/lib/facter/operatingsystemversion.rb">https://raw.github.com/liamjbennett/puppet-win_facts/master/lib/facter/operatingsystemversion.rb</a>)</p>

<p>As dicsussed in Part 1. The windows registry should be any windows developers friend and contains a weath of information. This is just one example &ndash; there are centainly plenty more than this. Puppet recently introduced the concept of External facts <a href="#53f76edfd65c1180adcd08fb6eb7bd45">[1]</a> &ndash; drop a file in the C:\ProgramData\PuppetLabs\facter\facts.d\ directory and facter will read it. This is good for many reasons but windows already has a great list of files containing facts &ndash; the windows registry &ndash; so let&rsquo;s read from it and find some more.</p>

<p>The alternative is the command wrapper:</p>

<pre><code>...
systemtype = Facter::Util::Resolution.exec('wmic ComputerSystem get SystemType | FindStr /i x')
systemtype.gsub!(/-based PC/,'')
systemtype.gsub!(/\s/,'')
systemtype.downcase!
....
</code></pre>

<p>(see: <a href="https://raw.github.com/liamjbennett/puppet-win_facts/master/lib/facter/windows_systemtype.rb">https://raw.github.com/liamjbennett/puppet-win_facts/master/lib/facter/windows_systemtype.rb</a>)</p>

<p>The registry is, for most people, a very complex nest of hidden information. Sometimes it doesn&rsquo;t contain all the information you need and sometimes it&rsquo;s difficult to find or process. In these cases it&rsquo;s always going to be an option to exec out and wrap an existing windows command. Windows has a wealth of small utilities <a href="#347ddd0bb5273c14a5cce0688cef7939">[2]</a> avaliable that can be used to pull out information, wmic is just one example of these.</p>

<p>Make sure that if your are going to exec that it&rsquo;s as simple as possible. No long multi-line commands, no pages of powershell. If your logic is suffiently complex then facter is probably not appropriate to execute it inline. Instead write a utility (C#, Powershell, or even ruby) and build, test and deploy that seperately. You can then execute that as a fact or execute it out-of-band and have it write a external fact. Either way, getting the complex logic out of the main facter code and making it simpiler for everyone wishing to use it or maintain it.</p>

<p>And that points me to another important thing &ndash; do test your facts! Many people, myself included are guilty of not doing this but it&rsquo;s pretty simple to do using standard rspec <a href="#9d7fcbe9e40e5fac0ea095bfdfdae797">[3]</a>.</p>

<p>Most windows libraries, utilities and applications vary widely from one version of windows to another (and sometimes from one edition or service pack to another) so I make plenty of use of these facts in my modules to take this into account and you should to.</p>

<h3>Writing classes for comman dependencies (dotnet)</h3>

<p>There is category of classes that will be used everywhere, they are not common code (that could be built into the PuppetX namespace) but they are common between manifests. Such classes include java, dotnet, powershell, ruby, gcc. I call these common dependencies.</p>

<p>Many people will implement common dependencies in different ways but the community really needs to converge on a standard for most of them &ndash; this hasn&rsquo;t happened yet. The first thing I would suggest is to <strong>always write as a definition first</strong> and only if it is totally impossible to install mutliple versions on the same machine (either legitimately or though some form of hack) should you make it a class. This is what I did with the dotnet module.</p>

<p>The .NET framework has some unique characteristics &ndash; firstly its installed differently on servers than it is on clients and secondly major versions (2,3,4) can be installed side-by-side while minor versions overwrite (4 and 4.5). I still made it a defintion because it can be installed side-by-side.</p>

<p>For modules like java and powershell there are even custom providers [4] that use those commands and will require seperate modules to make sure they are installed.</p>

<p>What I learnt about writing this module was actually a very simple lesson &ndash; <strong>don&rsquo;t assume how your users will want to provide the packages</strong>. I assumed the exe files used would be stored on a network share (this was my personal use-case) but what if your users want to download over http, use chocolatey or some other custom package manager. I want not have wanted to (or had time to) implement all the possibilities but this is really about good design and about amking your module as extensible as possible. I am still refactoring now to take this into account &ndash; it&rsquo;s easier if you design it in from the beginging.</p>

<p>These modules are probably the best modules &ndash; they are pretty quick to write, simple to test and get added everywhere so add huge value.</p>

<h3>Writing defintions, types and providers and knowning what&rsquo;s appropriate (windows_firewall)</h3>

<p>The windows firewall module was written to manage the built-in firewall provided by Microsoft. This is one situation, similiar to what I discussed with the facter facts above, where I wanted to provide a wrapper to the existing netsh commands. So that I what I did, wrote a manifest for the service and a defintion for the exceptions &ndash; this can be seen here (<a href="https://raw.github.com/liamjbennett/puppet-windows_firewall/master/manifests/exception.pp">https://raw.github.com/liamjbennett/puppet-windows_firewall/master/manifests/exception.pp</a>).</p>

<p>This works quite well and as an initial version meets the use-cases but it&rsquo;s far from elegant. This module raised the simple question: <strong>When should a defined type be refactored into a native type?</strong></p>

<p>There is also a good rule of thumb for this: <strong>If the effort spent munging variables and arguments is greater than the effort spent managing resources or calling exec then that should be a native type</strong>. What this meant for the windows_firewall module is that while the main class manifest should remain as it is, the defined type for exception should be made into a native type. For me this is currently a work-in-progress and can be seen in the <a href="https://github.com/liamjbennett/puppet-windows_firewall/tree/type_refactoring">&ldquo;type refactoring&rdquo; branch</a> on Github.</p>

<p>There are lots of benifits to writing types and providers. They are pure ruby, they can be tested as plain ruby, but more importantly they have the benefits of a turing-complete language and not being limited by the Puppet DSL. It does however also provide a great framework for managing and validating arguments and making sure that your type and providers remain idenpotent. For more information on how to write custom types and providers then go and read this great book on the subject (<a href="http://www.amazon.co.uk/Puppet-Types-Providers-Dan-Bode-ebook/dp/B00ANCH2GK/">Puppet Types and Providers</a>)</p>

<h3>Tackling the big applications (msoffice)</h3>

<p>For most windows infrastrcuture there come a point where you need to manage the much larger applications &ndash; you need to tackle those multi-GB applications normally distubuted via ISO. Taking on Microsoft, IBM, Oracle et al with Puppet is no small feat and is probably worth a much larger discussion but hopefully this will let you realise that such things are possible.</p>

<p>My first start at this was the Microsoft Office suite of applications. Most of these types of applications support silent installation to make it easy for administrators to deploy via group policy. We don&rsquo;t want to distrubute by group policy but we can use puppet to template these answer files and exec that silent installation.</p>

<p>Templating and Exec-ing that setup.exe is really as complicated as it gets with regards to pupept itself. You find that the remaining complexity comes from the applications itself.</p>

<p>But using those exec resources too is another smell. If your using more than one exec in your manifest and/or you keep calling out to the same command line tool then this is another suggest that you need to be writing more types and providers.</p>

<p>For larger more complicated applications you will find yourself using many of the tools in the puppet toolbox &ndash; custom types/providers, custom facts and perhaps custom functions. If you find yourself doing this try and make those thing as genric as possible and split them out into smaller modules. I am current working on a module of MSExchange <a href="#ce43fac37be445f0bb6a6c9d74b55752">[4]</a> and while prototyping this with ulgy exec statements and numerous hacks &ndash; it is leading down a path to create other modules for some custom functins and facts.</p>

<p>The point of this is to prove that all of those huge applications or suites of applications can still be installed and managed by puppet. It takes a great deal of initial effort, experience and on-oging work but it is worth it for us all in the long run. These sorts of applications come with long installation guides and come with certifications &ndash; we don&rsquo;t all need to read this and take the exams if we can make puppet do all the heavy lifting for us.</p>

<h3>References</h3>

<ul style="list-style-type: none; padding:0; margin:0;">
  <li>
    <a name="53f76edfd65c1180adcd08fb6eb7bd45">[1] http://puppetlabs.com/blog/facter-1-7-introduces-external-facts </a>
  </li>
  <li>
    <a name="347ddd0bb5273c14a5cce0688cef7939">[2] http://technet.microsoft.com/en-us/library/bb490890.aspx </a>
  </li>
  <li>
    <a name="9d7fcbe9e40e5fac0ea095bfdfdae797">[3] https://github.com/vStone/puppet-testing-example </a>
  </li>
  <li>
    <a name="ce43fac37be445f0bb6a6c9d74b55752">[4] https://github.com/liamjbennett/puppet-msexchange </a>
  </li>
</ul>


<p></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-12-11T09:18:00+00:00" pubdate data-updated="true">Dec 11<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/configuration-management/'>configuration-management</a>, <a class='category' href='/blog/categories/puppet/'>puppet</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/windows/'>windows</a>


</div>
	
</div></article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    Liam Bennett

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->





</body>
</html>
